<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Criar um Usuário</title>
    <link rel="stylesheet" href="../libs/bootstrap/bootstrap.css" />
    <link rel="stylesheet" href="../libs/DataTables/datatables.min.js" />
  </head>
  <body>
    <!-- Navbar (Menu Responsivo) -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Criar um Usuário</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="../index.html">Início</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./store.html">Lojas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./user.html">Usuários</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./register.html">Registros</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Configurações
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Perfil</a>
                <a class="dropdown-item" href="#">Configurações Gerais</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Sair</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <form>
        <div class="form-group">
          <label for="user">Nome:</label>
          <input
            type="text"
            class="form-control"
            id="user"
            placeholder="Nome Completo"
            required
          />
        </div>

        <div class="form-group">
          <label for="phone">Telefone:</label>
          <input type="number" class="form-control" id="phone" />
        </div>

        <div class="form-group">
          <label for="birthday">Data de Nascimento:</label>
          <input type="date" class="form-control" id="birthday" required />
        </div>

        <div class="form-group">
          <label for="email">Melhor Endereço de email</label>
          <input
            type="email"
            class="form-control"
            id="email"
            aria-describedby="emailHelp"
            placeholder="Seu email"
            required
          />
          <small id="emailHelp" class="form-text text-muted"
            >Nunca vamos compartilhar seu email, com ninguém.</small
          >
        </div>

        <div class="form-group">
          <label for="password">Senha</label>
          <input
            type="password"
            class="form-control"
            id="password"
            placeholder="Senha"
            required
          />
        </div>

        <div class="form-group">
          <label for="address_line1">Endereço Linha 1:</label>
          <input type="text" class="form-control" id="address_line1" required />
        </div>

        <div class="form-group">
          <label for="address_line1">Endereço Linha 2:</label>
          <input type="text" class="form-control" id="address_line2" required />
        </div>

        <div class="form-group">
          <label for="postalCode">Código Postal:</label>
          <input type="text" class="form-control" id="postalCode" required />
        </div>

        <div class="form-group">
          <label for="neighborhood">Bairro:</label>
          <input type="text" class="form-control" id="neighborhood" required />
        </div>

        <div class="form-group">
          <label for="city">Cidade:</label>
          <input type="text" class="form-control" id="city" required />
        </div>

        <div class="form-group">
          <label for="state">Estado:</label>
          <select class="form-control" id="state">
            <option value="AC">Acre</option>
            <option value="AL">Alagoas</option>
            <option value="AP">Amapá</option>
            <option value="AM">Amazonas</option>
            <option value="BA">Bahia</option>
            <option value="CE">Ceará</option>
            <option value="DF">Distrito Federal</option>
            <option value="ES">Espírito Santo</option>
            <option value="GO">Goiás</option>
            <option value="MA">Maranhão</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PA">Pará</option>
            <option value="PB">Paraíba</option>
            <option value="PR">Paraná</option>
            <option value="PE">Pernambuco</option>
            <option value="PI">Piauí</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RN">Rio Grande do Norte</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rondônia</option>
            <option value="RR">Roraima</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">São Paulo</option>
            <option value="SE">Sergipe</option>
            <option value="TO">Tocantins</option>
          </select>
        </div>

        <div class="form-group">
          <label for="country">País:</label>
          <input
            type="text"
            class="form-control"
            id="country"
            value="Brasil"
            readonly
            required
          />
        </div>

        <div class="form-group">
          <label for="level">Nível:</label>
          <select class="form-control" id="level">
            <option value="employee">Funcionário</option>
            <option value="employee">Gerente</option>
          </select>
        </div>

        <div class="form-group">
          <label for="id_store">Loja:</label>
          <select id="id_store" class="form-control"></select>
        </div>

        <div class="form-group form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="exampleCheck1"
            required
          />
          <label class="form-check-label" for="exampleCheck1"
            >Eu aceito os Termos e Condições</label
          >
        </div>

        <button type="submit" class="btn btn-primary">Enviar</button>
      </form>
    </div>
    <script src="../libs/jquery.js"></script>
    <script src="../libs/bootstrap/pooper.js"></script>
    <script src="../libs/bootstrap/bootstrap.js"></script>

    <script>
      $(document).ready(function () {
        // Adicione um evento de clique ao botão de envio do formulário
        $('form').submit(function (event) {
          // Impedir o envio padrão do formulário
          event.preventDefault();

          // Obter os dados do formulário
          var formData = {
            user: $('#user').val(),
            phone: $('#phone').val(),
            password: $('#password').val(),
            birthday: $('#birthday').val(),
            email: $('#email').val(),
            address_line1: $('#address_line1').val(),
            address_line2: $('#address_line2').val(),
            postalCode: $('#postalCode').val(),
            neighborhood: $('#neighborhood').val(),
            city: $('#city').val(),
            state: $('#state').val(),
            country: $('#country').val(),
            level: 'employee',
            active: 'active',
            id_store: $('#id_store').val(),
            // Adicione outros campos do formulário conforme necessário
          };

          // Fazer uma solicitação AJAX para o endpoint de criação de usuário
          $.ajax({
            url: 'http://localhost:5000/user/create',
            method: 'POST',
            contentType: 'application/json', // Definir o tipo de conteúdo para JSON
            data: JSON.stringify(formData), // Converter os dados do formulário para JSON
            success: function (response) {
              console.log('Sucesso:', response);

              alert('Usuário cadastrado com sucesso!');

              // Aguardar 3 segundos (3000 milissegundos) e redirecionar para uma nova página
              setTimeout(function () {
                window.location.href = './user.html'; // Substitua pela URL desejada
              }, 3000);
            },
            error: function (error) {
              console.error('Erro na solicitação AJAX:', error);
              alert('Erro ao cadastrar usuário!');
            },
          });
        });
      });
    </script>

    <script>
      // Quando a página carregar
      $(document).ready(function () {
        // Fazer uma solicitação AJAX para obter os dados da API
        $.ajax({
          url: 'http://localhost:5000/store/all', // Substitua pelo URL real da sua API
          method: 'GET',
          success: function (data) {
            // Limpar o conteúdo atual da tabela
            $('#store').empty();

            // Iterar sobre os resultados e adicionar à tabela
            data.forEach(function (item) {
              // Criar uma nova linha na tabela
              var newRow = $(
                `<option value="${item.id_store}">${item.store}</option>`
              );
              // Adicionar a linha à tabela
              $('#id_store').append(newRow);
            });
          },
          error: function (error) {
            console.error('Erro na solicitação AJAX:', error);
          },
        });
      });
    </script>
  </body>
</html>
